<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Reproducible computational environments using containers: Introduction to Singularity: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Reproducible computational environments using containers: Introduction to Singularity
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Reproducible computational environments using containers: Introduction to Singularity
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="about.html">About</a></li>
<li><a class="dropdown-item" href="discuss.html">Discussion</a></li>
<li><a class="dropdown-item" href="figures.html">Figures</a></li>
<li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Reproducible computational environments using containers: Introduction to Singularity
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-singularity-gettingstarted.html">1. Singularity: Getting started</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-singularity-cache.html">2. The Singularity cache</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-singularity-shell.html">3. Using Singularity containers to run commands</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-singularity-files.html">4. Files in Singularity containers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-singularity-docker.html">5. Using Docker images with Singularity</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-singularity-images-prep.html">6. Preparing to build Singularity images</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-singularity-images-building.html">7. Building Singularity images</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-singularity-mpi.html">8. Running MPI parallel jobs using Singularity containers</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="about.html">About</a></li>
<li><a href="discuss.html">Discussion</a></li>
<li><a href="figures.html">Figures</a></li>
<li><a href="reference.html">Glossary</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-singularity-gettingstarted"><p>Content from <a href="01-singularity-gettingstarted.html">Singularity: Getting started</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/01-singularity-gettingstarted.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Singularity and why might I want to use it?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand what Singularity is and when you might want to use
it.</li>
<li>Undertake your first run of a simple Singularity container.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The episodes in this lesson will introduce you to the <a href="https://sylabs.io/singularity/" class="external-link">Singularity</a> container platform
and demonstrate how to set up and use Singularity.</p>
<p>This material is split into 2 parts:</p>
<p><em>Part I: Basic usage, working with images</em></p>
<ol style="list-style-type: decimal">
<li>
<strong>Singularity: Getting started</strong>: This introductory
episode</li>
</ol>
<p>Working with Singularity containers:</p>
<ol start="2">
<li>
<strong>The singularity cache: </strong> Why, where and how does
Singularity cache images locally?
</li>
<li>
<strong>Running commands within a Singularity container: </strong> How
to run commands within a Singularity container.
</li>
<li>
<strong>Working with files and Singularity containers: </strong> Moving
files into a Singularity container; accessing files on the host from
within a container.
</li>
<li>
<strong>Using Docker images with Singularity: </strong>How to run
Singularity containers from Docker images.
</li>
</ol>
<em>Part II: Creating images, running parallel codes</em><ol start="6">
<li>
<strong>Preparing to build Singularity images</strong>: Getting started
with the Docker Singularity container.
</li>
<li>
<strong>Building Singularity images</strong>: Explaining how to build
and share your own Singularity images.
</li>
<li>
<strong>Running MPI parallel jobs using Singularity containers</strong>:
Explaining how to run MPI parallel codes from within Singularity
containers.
</li>
</ol>
<div id="work-in-progress" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="work-in-progress" class="callout-inner">
<h3 class="callout-title">Work in progress…</h3>
<div class="callout-content">
<p>This lesson is new material that is under ongoing development. We
will introduce Singularity and demonstrate how to work with it. As the
tools and best practices continue to develop, elements of this material
are likely to evolve. We welcome any comments or suggestions on how the
material can be improved or extended.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="singularity---part-i">Singularity - Part I<a class="anchor" aria-label="anchor" href="#singularity---part-i"></a>
</h2>
<hr class="half-width"></section><section><h2 class="section-heading" id="what-is-singularity">What is Singularity?<a class="anchor" aria-label="anchor" href="#what-is-singularity"></a>
</h2>
<hr class="half-width">
<p><a href="https://sylabs.io/singularity/" class="external-link">Singularity</a> is a
container platform that allows software engineers and researchers to
easily share their work with others by packaging and deploying their
software applications in a portable and reproducible manner. When you
download a Singularity container image, you essentially receive a
virtual computer disk that contains all of the necessary software,
libraries and configuration to run one or more applications or undertake
a particular task, e.g. to support a specific research project. This
saves you the time and effort of installing and configuring software on
your own system or setting up a new computer from scratch, as you can
simply run a Singularity container from the image and have a virtual
environment that is identical to the one used by the person who created
the image. Container platforms like Singularity provide a convenient and
consistent way to access and run software and tools. Singularity is
increasingly widely used in the research community for supporting
research projects as it allows users to isolate their software
environments from the host operating system and can simplify tasks such
as running multiple experiments simultaneously.</p>
<p>You may be familiar with Docker, another container platform that is
now used widely. If you are, you will see that in some ways, Singularity
is similar to Docker. However, in others, particularly in the system’s
architecture, it is fundamentally different. These differences mean that
Singularity is particularly well-suited to running on distributed, High
Performance Computing (HPC) infrastructure, as well as a Linux laptop or
desktop!</p>
<p><em>Later in this material, when we come to look at building
Singularity images ourselves, we will make use of Docker to provide an
environment in which we can run Singularity with administrative
privileges. In this context, some basic knowledge of Docker is strongly
recommended. If you are covering this module independently, or as part
of a course that hasn’t covered Docker, you can find an introduction to
Docker in the “<a href="https://carpentries-incubator.github.io/docker-introduction/index.html" class="external-link">Reproducible
Computational Environments Using Containers: Introduction to Docker</a>”
lesson.</em></p>
<p>System administrators will not, generally, install Docker on shared
computing platforms such as lab desktops, research clusters or HPC
platforms because the design of Docker presents potential security
issues for shared platforms with multiple users. Singularity, on the
other hand, can be run by end-users entirely within “user space”, that
is, no special administrative privileges need to be assigned to a user
in order for them to run and interact with containers on a platform
where Singularity has been installed.</p>
</section><section><h2 class="section-heading" id="what-is-the-relationship-between-singularity-singularityce-and-apptainer">What is the relationship between Singularity, SingularityCE and
Apptainer?<a class="anchor" aria-label="anchor" href="#what-is-the-relationship-between-singularity-singularityce-and-apptainer"></a>
</h2>
<hr class="half-width">
<p>Singularity is open source and was initially developed within the
research community. The company <a href="https://sylabs.io/" class="external-link">Sylabs</a>
was founded in 2018 to provide commercial support for Singularity. In <a href="https://sylabs.io/2021/05/singularity-community-edition/" class="external-link">May
2021</a>, Sylabs “forked” the codebase to create a new project called <a href="(https://sylabs.io/singularity)" class="external-link">SingularityCE</a> (where CE means
“Community Edition”). This in effect marks a common point from which two
projects—SingularityCE and Singularity—developed. Sylabs continue to
develop both the free, open source SingularityCE and a Pro/Enterprise
edition of the software. In November 2021, the original open source
Singularity project <a href="https://apptainer.org/news/community-announcement-20211130/" class="external-link">renamed
itself to Apptainer</a> and <a href="https://www.linuxfoundation.org/press/press-release/new-linux-foundation-project-accelerates-collaboration-on-container-systems-between-enterprise-and-high-performance-computing-environments" class="external-link">joined
the Linux Foundation</a>.</p>
<p>At the time of writing, in the context of the material covered in
this lesson, Apptainer and Singularity are effectively interchangeable.
If you are working on a platform that now has Apptainer installed, you
might find that the only change you need to make when working through
this material is to use the the command <code>apptainer</code> instead
of <code>singularity</code>. This course will continue to refer to
Singularity until differences between the projects warrant choosing one
project or the other for the course material.</p>
</section><section><h2 class="section-heading" id="getting-started-with-singularity">Getting started with Singularity<a class="anchor" aria-label="anchor" href="#getting-started-with-singularity"></a>
</h2>
<hr class="half-width">
<p>Initially developed within the research community, Singularity is
open source and the <a href="https://github.com/hpcng/singularity" class="external-link">repository</a> is currently
available in the “<a href="https://github.com/hpcng" class="external-link">The Next Generation
of High Performance Computing</a>” GitHub organisation. Part I of this
Singularity material is intended to be undertaken on a remote platform
where Singularity has been pre-installed.</p>
<p><em>If you’re attending a taught version of this course, you will be
provided with access details for a remote platform made available to you
for use for Part I of the Singularity material. This platform will have
the Singularity software pre-installed.</em></p>
<div id="installing-singularity-on-your-own-laptopdesktop" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="installing-singularity-on-your-own-laptopdesktop" class="callout-inner">
<h3 class="callout-title">Installing Singularity on your own laptop/desktop</h3>
<div class="callout-content">
<p>If you have a Linux system on which you have administrator access and
you would like to install Singularity on this system, some information
is provided at the start of <a href="06-singularity-images-prep.html">Part II of the Singularity
material</a>.</p>
</div>
</div>
</div>
<p>Sign in to the remote platform, with Singularity installed, that
you’ve been provided with access to. Check that the
<code>singularity</code> command is available in your terminal:</p>
<div id="loading-a-module" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="loading-a-module" class="callout-inner">
<h3 class="callout-title">Loading a module</h3>
<div class="callout-content">
<p>HPC systems often use <em>modules</em> to provide access to software
on the system so you may need to use the command:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> module load singularity</span></code></pre>
</div>
<p>before you can use the <code>singularity</code> command on the
system.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> singularity <span class="at">--version</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>singularity version 3.5.3</code></pre>
</div>
<p>Depending on the version of Singularity installed on your system, you
may see a different version. At the time of writing, <code>v3.5.3</code>
is the latest release of Singularity.</p>
</section><section><h2 class="section-heading" id="images-and-containers">Images and containers<a class="anchor" aria-label="anchor" href="#images-and-containers"></a>
</h2>
<hr class="half-width">
<p>We’ll start with a brief note on the terminology used in this section
of the course. We refer to both <strong><em>images</em></strong> and
<strong><em>containers</em></strong>. What is the distinction between
these two terms?</p>
<p><strong><em>Images</em></strong> are bundles of files including an
operating system, software and potentially data and other
application-related files. They may sometimes be referred to as a
<em>disk image</em> or <em>container image</em> and they may be stored
in different ways, perhaps as a single file, or as a group of files.
Either way, we refer to this file, or collection of files, as an
image.</p>
<p>A <strong><em>container</em></strong> is a virtual environment that
is based on an image. That is, the files, applications, tools, etc that
are available within a running container are determined by the image
that the container is started from. It may be possible to start multiple
container instances from an image. You could, perhaps, consider an image
to be a form of template from which running container instances can be
started.</p>
</section><section><h2 class="section-heading" id="getting-an-image-and-running-a-singularity-container">Getting an image and running a Singularity container<a class="anchor" aria-label="anchor" href="#getting-an-image-and-running-a-singularity-container"></a>
</h2>
<hr class="half-width">
<p>If you recall from learning about Docker, Docker images are formed of
a set of <em>layers</em> that make up the complete image. When you pull
a Docker image from Docker Hub, you see the different layers being
downloaded to your system. They are stored in your local Docker
repository on your system and you can see details of the available
images using the <code>docker</code> command.</p>
<p>Singularity images are a little different. Singularity uses the <a href="https://github.com/sylabs/sif" class="external-link">Singularity Image Format (SIF)</a>
and images are provided as single <code>SIF</code> files (with a
<code>.sif</code> filename extension). Singularity images can be pulled
from <a href="https://singularity-hub.org/" class="external-link">Singularity Hub</a>, a
registry for container images. Singularity is also capable of running
containers based on images pulled from <a href="https://hub.docker.com/" class="external-link">Docker Hub</a> and some other sources.
We’ll look at accessing containers from Docker Hub later in the
Singularity material.</p>
<div id="singularity-hub" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="singularity-hub" class="callout-inner">
<h3 class="callout-title">Singularity Hub</h3>
<div class="callout-content">
<p>Note that in addition to providing a repository that you can pull
images from, <a href="https://singularity-hub.org/" class="external-link">Singularity Hub</a>
can also build Singularity images for you from a
<strong><em>recipe</em></strong> - a configuration file defining the
steps to build an image. We’ll look at recipes and building images
later.</p>
</div>
</div>
</div>
<p>Let’s begin by creating a <code>test</code> directory, changing into
it and <em>pulling</em> a test <em>Hello World</em> image from
Singularity Hub:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> mkdir test</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">$</span> cd test</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">$</span> singularity pull hello-world.sif shub://vsoch/hello-world</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Downloading shub image
 59.75 MiB / 59.75 MiB [===============================================================================================================] 100.00% 52.03 MiB/s 1s</code></pre>
</div>
<p>What just happened?! We pulled a SIF image from Singularity Hub using
the <code>singularity pull</code> command and directed it to store the
image file using the name <code>hello-world.sif</code> in the current
directory. If you run the <code>ls</code> command, you should see that
the <code>hello-world.sif</code> file is now present in the current
directory. This is our image and we can now run a container based on
this image:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> singularity run hello-world.sif</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>RaawwWWWWWRRRR!! Avocado!</code></pre>
</div>
<p>The above command ran the <em>hello-world</em> container from the
image we downloaded from Singularity Hub and the resulting output was
shown.</p>
<p>How did the container determine what to do when we ran it?! What did
running the container actually do to result in the displayed output?</p>
<p>When you run a container from a Singularity image without using any
additional command line arguments, the container runs the default run
script that is embedded within the image. This is a shell script that
can be used to run commands, tools or applications stored within the
image on container startup. We can inspect the image’s run script using
the <code>singularity inspect</code> command:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> singularity inspect <span class="at">-r</span> hello-world.sif</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="co">#!/bin/sh</span></span>
<span></span>
<span><span class="va">exec</span> <span class="op">/</span><span class="va">bin</span><span class="op">/</span><span class="va">bash</span> <span class="op">/</span><span class="va">rawr.sh</span></span></code></pre>
</div>
<p>This shows us the script within the <code>hello-world.sif</code>
image configured to run by default when we use the
<code>singularity run</code> command.</p>
<p>That concludes this introductory Singularity episode. The next
episode looks in more detail at running containers.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Singularity is another container platform and it is often used in
cluster/HPC/research environments.</li>
<li>Singularity has a different security model to other container
platforms, one of the key reasons that it is well suited to HPC and
cluster environments.</li>
<li>Singularity has its own container image format (SIF).</li>
<li>The <code>singularity</code> command can be used to pull images from
Singularity Hub and run a container from an image file.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-02-singularity-cache"><p>Content from <a href="02-singularity-cache.html">The Singularity cache</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/02-singularity-cache.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Why does Singularity use a local cache?</li>
<li>Where does Singularity store images?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn about Singularity’s image cache.</li>
<li>Learn how to manage Singularity images stored locally.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="singularitys-image-cache">Singularity’s image cache<a class="anchor" aria-label="anchor" href="#singularitys-image-cache"></a>
</h2>
<hr class="half-width">
<p>While Singularity doesn’t have a local image repository in the same
way as Docker, it does cache downloaded image files. As we saw in the
previous episode, images are simply <code>.sif</code> files stored on
your local disk.</p>
<p>If you delete a local <code>.sif</code> image that you have pulled
from a remote image repository and then pull it again, if the image is
unchanged from the version you previously pulled, you will be given a
copy of the image file from your local cache rather than the image being
downloaded again from the remote source. This removes unnecessary
network transfers and is particularly useful for large images which may
take some time to transfer over the network. To demonstrate this, remove
the <code>hello-world.sif</code> file stored in your <code>test</code>
directory and then issue the <code>pull</code> command again:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> rm hello-world.sif</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> singularity pull hello-world.sif shub://vsoch/hello-world</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Use image from cache</code></pre>
</div>
<p>As we can see in the above output, the image has been returned from
the cache and we don’t see the output that we saw previously showing the
image being downloaded from Singularity Hub.</p>
<p>How do we know what is stored in the local cache? We can find out
using the <code>singularity cache</code> command:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> singularity cache list</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>There are 1 container file(s) using 62.65 MB and 0 oci blob file(s) using 0.00 kB of space
Total space used: 62.65 MB</code></pre>
</div>
<p>This tells us how many container files are stored in the cache and
how much disk space the cache is using but it doesn’t tell us
<em>what</em> is actually being stored. To find out more information we
can add the <code>-v</code> verbose flag to the <code>list</code>
command:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> singularity cache list <span class="at">-v</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>NAME                     DATE CREATED           SIZE             TYPE
hello-world_latest.sif   2020-04-03 13:20:44    62.65 MB         shub

There are 1 container file(s) using 62.65 MB and 0 oci blob file(s) using 0.00 kB of space
Total space used: 62.65 MB</code></pre>
</div>
<p>This provides us with some more useful information about the actual
images stored in the cache. In the <code>TYPE</code> column we can see
that our image type is <code>shub</code> because it’s a <code>SIF</code>
image that has been pulled from Singularity Hub.</p>
<div id="cleaning-the-singularity-image-cache" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cleaning-the-singularity-image-cache" class="callout-inner">
<h3 class="callout-title">Cleaning the Singularity image cache</h3>
<div class="callout-content">
<p>We can remove images from the cache using the
<code>singularity cache clean</code> command. Running the command
without any options will display a warning and ask you to confirm that
you want to remove everything from your cache.</p>
<p>You can also remove specific images or all images of a particular
type. Look at the output of <code>singularity cache clean --help</code>
for more information.</p>
</div>
</div>
</div>
<div id="cache-location" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cache-location" class="callout-inner">
<h3 class="callout-title">Cache location</h3>
<div class="callout-content">
<p>By default, Singularity uses <code>$HOME/.singularity/cache</code> as
the location for the cache. You can change the location of the cache by
setting the <code>SINGULARITY_CACHEDIR</code> environment variable to
the cache location you want to use.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Singularity caches downloaded images so that an unchanged image
isn’t downloaded again when it is requested using the
<code>singularity pull</code> command.</li>
<li>You can free up space in the cache by removing all locally cached
images or by specifying individual images to remove.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-03-singularity-shell"><p>Content from <a href="03-singularity-shell.html">Using Singularity containers to run commands</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/03-singularity-shell.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I run different commands within a container?</li>
<li>How do I access an interactive shell within a container?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run different commands when starting a container.</li>
<li>Learn how to open an interactive shell within a container
environment.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="running-specific-commands-within-a-container">Running specific commands within a container<a class="anchor" aria-label="anchor" href="#running-specific-commands-within-a-container"></a>
</h2>
<hr class="half-width">
<p>We saw earlier that we can use the <code>singularity inspect</code>
command to see the run script that a container is configured to run by
default. What if we want to run a different command within a
container?</p>
<p>If we know the path of an executable that we want to run within a
container, we can use the <code>singularity exec</code> command. For
example, using the <code>hello-world.sif</code> container that we’ve
already pulled from Singularity Hub, we can run the following within the
<code>test</code> directory where the <code>hello-world.sif</code> file
is located:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> singularity exec hello-world.sif /bin/echo Hello World!</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Hello World!</code></pre>
</div>
<p>Here we see that a container has been started from the
<code>hello-world.sif</code> image and the <code>/bin/echo</code>
command has been run within the container, passing the input
<code>Hello World!</code>. The command has echoed the provided input to
the console and the container has terminated.</p>
<p>Note that the use of <code>singularity exec</code> has overriden any
run script set within the image metadata and the command that we
specified as an argument to <code>singularity exec</code> has been run
instead.</p>
<div id="basic-exercise-running-a-different-command-within-the-hello-world-container" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="basic-exercise-running-a-different-command-within-the-hello-world-container" class="callout-inner">
<h3 class="callout-title">Basic exercise: Running a different command within the “hello-world” container</h3>
<div class="callout-content">
<p>Can you run a container based on the <code>hello-world.sif</code>
image that <strong>prints the current date and time</strong>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> singularity exec hello-world.sif /bin/date</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Fri Jun 26 15:17:44 BST 2020</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><br> #### <strong>The difference between
<code>singularity run</code> and
<code>singularity exec</code></strong></p>
<p>Above we used the <code>singularity exec</code> command. In earlier
episodes of this course we used <code>singularity run</code>. To
clarify, the difference between these two commands is:</p>
<ul>
<li><p><code>singularity run</code>: This will run the default command
set for containers based on the specfied image. This default command is
set within the image metadata when the image is built (we’ll see more
about this in later episodes). You do not specify a command to run when
using <code>singularity run</code>, you simply specify the image file
name. As we saw earlier, you can use the
<code>singularity inspect</code> command to see what command is run by
default when starting a new container based on an image.</p></li>
<li><p><code>singularity exec</code>: This will start a container based
on the specified image and run the command provided on the command line
following <code>singularity exec &lt;image file name&gt;</code>. This
will override any default command specified within the image metadata
that would otherwise be run if you used
<code>singularity run</code>.</p></li>
</ul></section><section><h2 class="section-heading" id="opening-an-interactive-shell-within-a-container">Opening an interactive shell within a container<a class="anchor" aria-label="anchor" href="#opening-an-interactive-shell-within-a-container"></a>
</h2>
<hr class="half-width">
<p>If you want to open an interactive shell within a container,
Singularity provides the <code>singularity shell</code> command. Again,
using the <code>hello-world.sif</code> image, and within our
<code>test</code> directory, we can run a shell within a container from
the hello-world image:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> singularity shell hello-world.sif</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Singularity&gt; whoami
[&lt;your username&gt;]
Singularity&gt; ls
hello-world.sif
Singularity&gt; </code></pre>
</div>
<p>As shown above, we have opened a shell in a new container started
from the <code>hello-world.sif</code> image. Note that the shell prompt
has changed to show we are now within the Singularity container.</p>
<div id="discussion-running-a-shell-inside-a-singularity-container" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="discussion-running-a-shell-inside-a-singularity-container" class="callout-inner">
<h3 class="callout-title">Discussion: Running a shell inside a Singularity container</h3>
<div class="callout-content">
<p>Q: What do you notice about the output of the above commands entered
within the Singularity container shell?</p>
<p>Q: Does this differ from what you might see within a Docker
container?</p>
</div>
</div>
</div>
<p>Use the <code>exit</code> command to exit from the container
shell.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The <code>singularity exec</code> is an alternative to
<code>singularity run</code> that allows you to start a container
running a specific command.</li>
<li>The <code>singularity shell</code> command can be used to start a
container and run an interactive shell within it.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-04-singularity-files"><p>Content from <a href="04-singularity-files.html">Files in Singularity containers</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/04-singularity-files.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I make data available in a Singularity container?</li>
<li>What data is made available by default in a Singularity
container?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand that some data from the host system is usually made
available by default within a container</li>
<li>Learn more about how Singularity handles users and binds directories
from the host filesystem.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The way in which user accounts and access permissions are handeld in
Singularity containers is very different from that in Docker (where you
effectively always have superuser/root access). When running a
Singularity container, you only have the same permissions to access
files as the user you are running as on the host system.</p>
<p>In this episode we’ll look at working with files in the context of
Singularity containers and how this links with Singularity’s approach to
users and permissions within containers.</p>
<section><h2 class="section-heading" id="users-within-a-singularity-container">Users within a Singularity container<a class="anchor" aria-label="anchor" href="#users-within-a-singularity-container"></a>
</h2>
<hr class="half-width">
<p>The first thing to note is that when you ran <code>whoami</code>
within the container shell you started at the end of the previous
episode, you should have seen the username that you were signed in as on
the host system when you ran the container.</p>
<p>For example, if my username were <code>jc1000</code>, I’d expect to
see the following:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> singularity shell hello-world.sif</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">Singularity</span><span class="op">&gt;</span> whoami</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">jc1000</span></span></code></pre>
</div>
<p>But hang on! I downloaded the standard, public version of the
<code>hello-world.sif</code> image from Singularity Hub. I haven’t
customised it in any way. How is it configured with my own user
details?!</p>
<p>If you have any familiarity with Linux system administration, you may
be aware that in Linux, users and their Unix groups are configured in
the <code>/etc/passwd</code> and <code>/etc/group</code> files
respectively. In order for the shell within the container to know of my
user, the relevant user information needs to be available within these
files within the container.</p>
<p>Assuming this feature is enabled within the installation of
Singularity on your system, when the container is started, Singularity
appends the relevant user and group lines from the host system to the
<code>/etc/passwd</code> and <code>/etc/group</code> files within the
container <a href="https://www.intel.com/content/dam/www/public/us/en/documents/presentation/hpc-containers-singularity-advanced.pdf" class="external-link"><span class="math display">\[1\]</span></a>.</p>
<p>This means that the host system can effectively ensure that you
cannot access/modify/delete any data you should not be able to on the
host system and you cannot run anything that you would not have
permission to run on the host system since you are restricted to the
same user permissions within the container as you are on the host
system.</p>
</section><section><h2 class="section-heading" id="files-and-directories-within-a-singularity-container">Files and directories within a Singularity container<a class="anchor" aria-label="anchor" href="#files-and-directories-within-a-singularity-container"></a>
</h2>
<hr class="half-width">
<p>Singularity also <em>binds</em> some <em>directories</em> from the
host system where you are running the <code>singularity</code> command
into the container that you’re starting. Note that this bind process is
not copying files into the running container, it is making an existing
directory on the host system visible and accessible within the container
environment. If you write files to this directory within the running
container, when the container shuts down, those changes will persist in
the relevant location on the host system.</p>
<p>There is a default configuration of which files and directories are
bound into the container but ultimate control of how things are set up
on the system where you are running Singularity is determined by the
system administrator. As a result, this section provides an overview but
you may find that things are a little different on the system that
you’re running on.</p>
<p>One directory that is likely to be accessible within a container that
you start is your <em>home directory</em>. You may also find that the
directory from which you issued the <code>singularity</code> command
(the <em>current working directory</em>) is also mapped.</p>
<p>The mapping of file content and directories from a host system into a
Singularity container is illustrated in the example below showing a
subset of the directories on the host Linux system and in a Singularity
container:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Host system:                                                      Singularity container:
-------------                                                     ----------------------
/                                                                 /
├── bin                                                           ├── bin
├── etc                                                           ├── etc
│   ├── ...                                                       │   ├── ...
│   ├── group  ─&gt; user's group added to group file in container ─&gt;│   ├── group
│   └── passwd ──&gt; user info added to passwd file in container ──&gt;│   └── passwd
├── home                                                          ├── usr
│   └── jc1000 ───&gt; user home directory made available ──&gt; ─┐     ├── sbin
├── usr                 in container via bind mount         │     ├── home
├── sbin                                                    └────────&gt;└── jc1000
└── ...                                                           └── ...
</code></pre>
</div>
<div id="questions-and-exercises-files-in-singularity-containers" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="questions-and-exercises-files-in-singularity-containers" class="callout-inner">
<h3 class="callout-title">Questions and exercises: Files in Singularity containers</h3>
<div class="callout-content">
<p><strong>Q1:</strong> What do you notice about the ownership of files
in a container started from the hello-world image? (e.g. take a look at
the ownership of files in the root directory (<code>/</code>))</p>
<p><strong>Exercise 1:</strong> In this container, try editing (for
example using the editor <code>vi</code> which should be avaiable in the
container) the <code>/rawr.sh</code> file. What do you notice?</p>
<p><em>If you’re not familiar with <code>vi</code> there are many quick
reference pages online showing the main commands for using the editor,
for example <a href="https://web.mit.edu/merolish/Public/vi-ref.pdf" class="external-link">this
one</a>.</em></p>
<p><strong>Exercise 2:</strong> In your home directory within the
container shell, try and create a simple text file. Is it possible to do
this? If so, why? If not, why not?! If you can successfully create a
file, what happens to it when you exit the shell and the container shuts
down?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Answers
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p><strong>A1:</strong> Use the <code>ls -l</code> command to see a
detailed file listing including file ownership and permission details.
You should see that most of the files in the <code>/</code> directory
are owned by <code>root</code>, as you’d probably expect on any Linux
system. If you look at the files in your home directory, they should be
owned by you.</p>
<p><strong>A Ex1:</strong> We’ve already seen from the previous answer
that the files in <code>/</code> are owned by <code>root</code> so we
wouldn’t expect to be able to edit them if we’re not the root user.
However, if you tried to edit <code>/rawr.sh</code> you probably saw
that the file was read only and, if you tried for example to delete the
file you would have seen an error similar to the following:
<code>cannot remove '/rawr.sh': Read-only file system</code>. This tells
us something else about the filesystem. It’s not just that we don’t have
permission to delete the file, the filesystem itself is read-only so
even the <code>root</code> user wouldn’t be able to edit/delete this
file. We’ll look at this in more detail shortly.</p>
<p><strong>A Ex2:</strong> Within your home directory, you
<em>should</em> be able to successfully create a file. Since you’re
seeing your home directory on the host system which has been bound into
the container, when you exit and the container shuts down, the file that
you created within the container should still be present when you look
at your home directory on the host system.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="binding-additional-host-system-directories-to-the-container">Binding additional host system directories to the container<a class="anchor" aria-label="anchor" href="#binding-additional-host-system-directories-to-the-container"></a>
</h2>
<hr class="half-width">
<p>You will sometimes need to bind additional host system directories
into a container you are using over and above those bound by default.
For example:</p>
<ul>
<li>There may be a shared dataset in a shard location that you need
access to in the container</li>
<li>You may require executables and software libraries in the
container</li>
</ul>
<p>The <code>-B</code> option to the <code>singularity</code> command is
used to specify additonal binds. For example, to bind the
<code>/work/z19/shared</code> directory into a container you could use
(note this directory is unlikely to exist on the host system you are
using so you’ll need to test this using a different directory):</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> singularity shell <span class="at">-B</span> /work/z19/shared hello-world.sif</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">Singularity</span><span class="op">&gt;</span> ls /work/z19/shared</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CP2K-regtest	    cube	     eleanor		   image256x192.pgm		kevin		    pblas			    q-e-qe-6.7
ebe		    evince.simg	     image512x384.pgm	   low_priority.slurm           pblas.tar.gz	                                    q-qe
Q1529568	    edge192x128.pgm  extrae		   image768x1152.pgm		mkdir		    petsc			    regtest-ls-rtp_forCray
adrianj		    edge256x192.pgm  gnuplot-5.4.1.tar.gz  image768x768.pgm		moose.job	    petsc-hypre			    udunits-2.2.28.tar.gz
antlr-2.7.7.tar.gz  edge512x384.pgm  hj			   job-defmpi-cpe-21.03-robust	mrb4cab		    petsc-hypre-cpe21.03	    xios-2.5
cdo-archer2.sif     edge768x768.pgm  image192x128.pgm	   jsindt			paraver		    petsc-hypre-cpe21.03-gcc10.2.0</code></pre>
</div>
<p>Note that, by default, a bind is mounted at the same path in the
container as on the host system. You can also specify where a host
directory is mounted in the container by separating the host path from
the container path by a colon (<code>:</code>) in the option:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> singularity shell <span class="at">-B</span> /work/z19/shared:/shared-data hello-world.sif</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="ex">Singularity</span><span class="op">&gt;</span> ls /shared-data</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CP2K-regtest	    cube	     eleanor		   image256x192.pgm		kevin		    pblas			    q-e-qe-6.7
ebe		    evince.simg	     image512x384.pgm	   low_priority.slurm           pblas.tar.gz	                                    q-qe
Q1529568	    edge192x128.pgm  extrae		   image768x1152.pgm		mkdir		    petsc			    regtest-ls-rtp_forCray
adrianj		    edge256x192.pgm  gnuplot-5.4.1.tar.gz  image768x768.pgm		moose.job	    petsc-hypre			    udunits-2.2.28.tar.gz
antlr-2.7.7.tar.gz  edge512x384.pgm  hj			   job-defmpi-cpe-21.03-robust	mrb4cab		    petsc-hypre-cpe21.03	    xios-2.5
cdo-archer2.sif     edge768x768.pgm  image192x128.pgm	   jsindt			paraver		    petsc-hypre-cpe21.03-gcc10.2.0</code></pre>
</div>
<p>You can also specify multiple binds to <code>-B</code> by separating
them by commas (<code>,</code>).</p>
<p>You can also copy data into a container image at build time if there
is some static data required in the image. We cover this later in the
section on building Singularity containers.</p>
</section><section><h2 class="section-heading" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<p><span class="math display">\[1\]</span> Gregory M. Kurzer, Containers
for Science, Reproducibility and Mobility: Singularity P2. Intel HPC
Developer Conference, 2017. Available at: <a href="https://www.intel.com/content/dam/www/public/us/en/documents/presentation/hpc-containers-singularity-advanced.pdf" class="external-link">https://www.intel.com/content/dam/www/public/us/en/documents/presentation/hpc-containers-singularity-advanced.pdf</a></p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Your current directory and home directory are usually available by
default in a container.</li>
<li>You have the same username and permissions in a container as on the
host system.</li>
<li>You can specify additional host system directories to be available
in the container.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-05-singularity-docker"><p>Content from <a href="05-singularity-docker.html">Using Docker images with Singularity</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/05-singularity-docker.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I use Docker images with Singularity?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run Singularity containers based on Docker images.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="using-docker-images-with-singularity">Using Docker images with Singularity<a class="anchor" aria-label="anchor" href="#using-docker-images-with-singularity"></a>
</h2>
<hr class="half-width">
<p>Singularity can also start containers directly from Docker images,
opening up access to a huge number of existing container images
available on <a href="https://hub.docker.com/" class="external-link">Docker Hub</a> and other
registries.</p>
<p>While Singularity doesn’t actually run a container using the Docker
image (it first converts it to a format suitable for use by
Singularity), the approach used provides a seamless experience for the
end user. When you direct Singularity to run a container based on pull a
Docker image, Singularity pulls the slices or <em>layers</em> that make
up the Docker image and converts them into a single-file Singularity SIF
image.</p>
<p>For example, moving on from the simple <em>Hello World</em> examples
that we’ve looked at so far, let’s pull one of the <a href="https://hub.docker.com/_/python" class="external-link">official Docker Python
images</a>. We’ll use the image with the tag
<code>3.9.6-slim-buster</code> which has Python 3.9.6 installed on
Debian’s <a href="https://www.debian.org/releases/buster/" class="external-link">Buster</a>
(v10) Linux distribution:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> singularity pull python-3.9.6.sif docker://python:3.9.6-slim-buster</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Converting OCI blobs to SIF format
INFO:    Starting build...
Getting image source signatures
Copying blob 33847f680f63 done
Copying blob b693dfa28d38 done
Copying blob ef8f1a8cefd1 done
Copying blob 248d7d56b4a7 done
Copying blob 478d2dfa1a8d done
Copying config c7d70af7c3 done
Writing manifest to image destination
Storing signatures
2021/07/27 17:23:38  info unpack layer: sha256:33847f680f63fb1b343a9fc782e267b5abdbdb50d65d4b9bd2a136291d67cf75
2021/07/27 17:23:40  info unpack layer: sha256:b693dfa28d38fd92288f84a9e7ffeba93eba5caff2c1b7d9fe3385b6dd972b5d
2021/07/27 17:23:40  info unpack layer: sha256:ef8f1a8cefd144b4ee4871a7d0d9e34f67c8c266f516c221e6d20bca001ce2a5
2021/07/27 17:23:40  info unpack layer: sha256:248d7d56b4a792ca7bdfe866fde773a9cf2028f973216160323684ceabb36451
2021/07/27 17:23:40  info unpack layer: sha256:478d2dfa1a8d7fc4d9957aca29ae4f4187bc2e5365400a842aaefce8b01c2658
INFO:    Creating SIF file...</code></pre>
</div>
<p>Note how we see singularity saying that it’s “<em>Converting OCI
blobs to SIF format</em>”. We then see the layers of the Docker image
being downloaded and unpacked and written into a single SIF file. Once
the process is complete, we should see the python-3.9.6.sif image file
in the current directory.</p>
<p>We can now run a container from this image as we would with any other
singularity image.</p>
<div id="running-the-python-3.9.6-image-that-we-just-pulled-from-docker-hub" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="running-the-python-3.9.6-image-that-we-just-pulled-from-docker-hub" class="callout-inner">
<h3 class="callout-title">Running the Python 3.9.6 image that we just pulled from Docker Hub</h3>
<div class="callout-content">
<p>Try running the Python 3.9.6 image. What happens?</p>
<p>Try running some simple Python statements…</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Running the Python 3.9.6 image </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> singularity run python-3.9.6.sif</span></code></pre>
</div>
<p>This should put you straight into a Python interactive shell within
the running container:</p>
<pre><code>Python 3.9.6 (default, Jul 22 2021, 15:24:21)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; </code></pre>
<p>Now try running some simple Python statements:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> math</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> math.pi</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fl">3.141592653589793</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> </span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>In addition to running a container and having it run the default run
script, you could also start a container running a shell in case you
want to undertake any configuration prior to running Python. This is
covered in the following exercise:</p>
<div id="open-a-shell-within-a-python-container" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="open-a-shell-within-a-python-container" class="callout-inner">
<h3 class="callout-title">Open a shell within a Python container</h3>
<div class="callout-content">
<p>Try to run a shell within a singularity container based on the
<code>python-3.9.6.sif</code> image. That is, run a container that opens
a shell rather than the default Python interactive console as we saw
above. See if you can find more than one way to achieve this.</p>
<p>Within the shell, try starting the Python interactive console and
running some Python commands.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Recall from the earlier material that we can use the
<code>singularity shell</code> command to open a shell within a
container. To open a regular shell within a container based on the
<code>python-3.9.6.sif</code> image, we can therefore simply run:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> singularity shell python-3.9.6.sif</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Singularity&gt; echo $SHELL
/bin/bash
Singularity&gt; cat /etc/issue
Debian GNU/Linux 10 \n \l

Singularity&gt; python
Python 3.9.6 (default, Jul 22 2021, 15:24:21)
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; print('Hello World!')
Hello World!
&gt;&gt;&gt; exit()

Singularity&gt; exit
$ </code></pre>
</div>
<p>It is also possible to use the <code>singularity exec</code> command
to run an executable within a container. We could, therefore, use the
<code>exec</code> command to run <code>/bin/bash</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> singularity exec python-3.9.6.sif /bin/bash</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Singularity&gt; echo $SHELL
/bin/bash</code></pre>
</div>
<p>You can run the Python console from your container shell simply by
running the <code>python</code> command.</p>
</div>
</div>
</div>
</div>
<p>This concludes the fifth episode and Part I of the Singularity
material. Part II contains a further three episodes where we’ll look at
creating your own images and then more advanced use of containers for
running MPI parallel applications.</p>
</section><section><h2 class="section-heading" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<hr class="half-width">
<p><span class="math display">\[1\]</span> Gregory M. Kurzer, Containers
for Science, Reproducibility and Mobility: Singularity P2. Intel HPC
Developer Conference, 2017. Available at: <a href="https://www.intel.com/content/dam/www/public/us/en/documents/presentation/hpc-containers-singularity-advanced.pdf" class="external-link">https://www.intel.com/content/dam/www/public/us/en/documents/presentation/hpc-containers-singularity-advanced.pdf</a></p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Singularity can start a container from a Docker image which can be
pulled directly from Docker Hub.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-06-singularity-images-prep"><p>Content from <a href="06-singularity-images-prep.html">Preparing to build Singularity images</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/06-singularity-images-prep.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What environment do I need to build a Singularity image and how do I
set it up?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand how to the Docker Singularity image provides an
environment for building Singularity images.</li>
<li>Understand different ways to run containers based on the Docker
Singularity image.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="singularity---part-ii">Singularity - Part II<a class="anchor" aria-label="anchor" href="#singularity---part-ii"></a>
</h2>
<hr class="half-width"></section><section><h2 class="section-heading" id="brief-recap">Brief recap<a class="anchor" aria-label="anchor" href="#brief-recap"></a>
</h2>
<hr class="half-width">
<p>In the five episodes covering Part I of this Singularity material
we’ve seen how Singularity can be used on a computing platform where you
don’t have any administrative privileges. The software was pre-installed
and it was possible to work with existing images such as Singularity
image files already stored on the platform or images obtained from a
remote image repository such as Singularity Hub or Docker Hub.</p>
<p>It is clear that between Singularity Hub and Docker Hub there is a
huge array of images available, pre-configured with a wide range of
software applications, tools and services. But what if you want to
create your own images or customise existing images?</p>
<p>In this first of three episodes in Part II of the Singularity
material, we’ll look at preparing to build Singularity images.</p>
</section><section><h2 class="section-heading" id="preparing-to-use-singularity-for-building-images">Preparing to use Singularity for building images<a class="anchor" aria-label="anchor" href="#preparing-to-use-singularity-for-building-images"></a>
</h2>
<hr class="half-width">
<p>So far you’ve been able to work with Singularity from your own user
account as a non-privileged user. This part of the Singularity material
requires that you use Singularity in an environment where you have
administrative (root) access. While it is possible to build Singularity
containers without root access, it is highly recommended that you do
this as the <em>root</em> user, as highlighted in <a href="https://sylabs.io/guides/3.5/user-guide/build_a_container.html#creating-writable-sandbox-directories" class="external-link">this
section</a> of the Singularity documentation. Bear in mind that the
system that you use to build containers doesn’t have to be the system
where you intend to run the containers. If, for example, you are
intending to build a container that you can subsequently run on a
Linux-based cluster, you could build the container on your own
Linux-based desktop or laptop computer. You could then transfer the
built image directly to the target platform or upload it to an image
repository and pull it onto the target platform from this
repository.</p>
<p>There are <strong>three</strong> different options for accessing a
suitable environment to undertake the material in this part of the
course:</p>
<ol style="list-style-type: decimal">
<li>Run Singularity from within a Docker container - this will enable
you to have the required privileges to build images</li>
<li>Install Singularity locally on a system where you have
administrative access</li>
<li>Use Singularity on a system where it is already pre-installed and
you have administrative (root) access</li>
</ol>
<p>We’ll focus on the first option in this part of the course -
<em>running singularity from within a Docker container</em>. If you
would like to install Singularity directly on your system, see the box
below for some further pointers. However, please note that the
installation process is an advanced task that is beyond the scope of
this course so we won’t be covering this.</p>
<div id="installing-singularity-on-your-local-system-optional-advanced-task" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="installing-singularity-on-your-local-system-optional-advanced-task" class="callout-inner">
<h3 class="callout-title">Installing Singularity on your local system
(optional) <span class="math display">\[Advanced task\]</span>
</h3>
<div class="callout-content">
<p>If you are running Linux and would like to install Singularity
locally on your system, the source code is provided via the <a href="https://github.com/hpcng" class="external-link">The Next Generation of High Performance
Computing (HPCng) community</a>’s <a href="https://github.com/hpcng/singularity" class="external-link">Singularity repository</a>.
See the releases <a href="https://github.com/hpcng/singularity/releases" class="external-link">here</a>. You will
need to install various dependencies on your system and then build
Singularity from source code.</p>
<p><em>If you are not familiar with building applications from source
code, it is strongly recommended that you use the Docker Singularity
image, as described below in the “Getting started with the Docker
Singularity image” section rather than attempting to build and install
Singularity yourself. The installation process is an advanced task that
is beyond the scope of this session.</em></p>
<p>However, if you have Linux systems knowledge and would like to
attempt a local install of Singularity, you can find details in the <a href="https://github.com/hpcng/singularity/blob/master/INSTALL.md" class="external-link">INSTALL.md</a>
file within the Singularity repository that explains how to install the
prerequisites and build and install the software. Singularity is written
in the <a href="https://golang.org/" class="external-link">Go</a> programming language and Go
is the main dependency that you’ll need to install on your system. The
process of installing Go and any other requirements is detailed in the
INSTALL.md file.</p>
</div>
</div>
</div>
<div id="note" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="note" class="callout-inner">
<h3 class="callout-title">Note</h3>
<div class="callout-content">
<p>If you do not have access to a system with Docker installed, or a
Linux system where you can build and install Singularity but you have
administrative privileges on another system, you could look at
installing a virtualisation tool such as <a href="https://www.virtualbox.org/" class="external-link">VirtualBox</a> on which you could run
a Linux Virtual Machine (VM) image. Within the Linux VM image, you will
be able to install Singularity. Again this is beyond the scope of the
course.</p>
<p>If you are not able to access/run Singularity yourself on a system
where you have administrative privileges, you can still follow through
this material as it is being taught (or read through it in your own time
if you’re not participating in a taught version of the course) since it
will be helpful to have an understanding of how Singularity images can
be built.</p>
<p>You could also attempt to follow this section of the lesson without
using root and instead using the <code>singularity</code> command’s <a href="https://sylabs.io/guides/3.5/user-guide/fakeroot.html" class="external-link"><code>--fakeroot</code></a>
option. However, you may encounter issues with permissions when trying
to build images and run your containers and this is why running the
commands as root is strongly recommended and is the approach described
in this lesson.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="getting-started-with-the-docker-singularity-image">Getting started with the Docker Singularity image<a class="anchor" aria-label="anchor" href="#getting-started-with-the-docker-singularity-image"></a>
</h2>
<hr class="half-width">
<p>The <a href="https://quay.io/repository/singularity/singularity" class="external-link">Singularity
Docker image</a> is available from <a href="https://quay.io/" class="external-link">Quay.io</a>.</p>
<div id="familiarise-yourself-with-the-docker-singularity-image" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="familiarise-yourself-with-the-docker-singularity-image" class="callout-inner">
<h3 class="callout-title">Familiarise yourself with the Docker Singularity image</h3>
<div class="callout-content">
<ul>
<li><p>Using your previously acquired Docker knowledge, get the
Singularity image for <code>v3.5.3</code> and ensure that you can run a
Docker container using this image. For this exercise, we recommend using
the image with the <code>v3.5.3-slim</code> tag since it’s a much
smaller image.</p></li>
<li>
<p>Create a directory (e.g. <code>$HOME/singularity_data</code>) on
your host machine that you can use for storage of <em>definition
files</em> (we’ll introduce these shortly) and generated image
files.</p>
<p>This directory should be bind mounted into the Docker container at
the location <code>/home/singularity</code> every time you run it - this
will give you a location in which to store built images so that they are
available on the host system once the container exits. (take a look at
the <code>-v</code> switch to the <code>docker run</code>
command)</p>
</li>
</ul>
<p><em>Hint: To be able to build an image using the Docker Singularity
container, you’ll need to add the <code>--privileged</code> switch to
your docker command line.</em></p>
<p><em>Hint: If you want to run a shell within the Docker Singularity
container, you’ll need to override the entrypoint to tell the container
to run <code>/bin/bash</code> - take a look at Docker’s
<code>--entrypoint</code> switch.</em></p>
<p>Questions / Exercises:</p>
<ol style="list-style-type: decimal">
<li>Can you run a container from the Docker Singularity image? What is
happening when you run the container?</li>
<li>Can you run an interactive <code>/bin/sh</code> shell in the Docker
Singularity container?</li>
<li>Can you run an interactive Singularity shell in a Singularity
container, within the Docker Singularity container?!</li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Running a container from the image
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Answers:</p>
<ol style="list-style-type: decimal">
<li><em>Can you run a container from the Docker Singularity image? What
is happening when you run the container?</em></li>
</ol>
<p>The name/tag of the Docker Singularity image we’ll be using is:
<code>quay.io/singularity/singularity:v3.5.3-slim</code></p>
<p>Having a bound directory from the host system accessible within your
running Docker Singularity container will give you somewhere to place
created Singularity images so that they are accessible on the host
system after the container exits. Begin by changing into the directory
that you created above for storing your definiton files and built images
(e.g. <code>$HOME/singularity_data</code>).</p>
<p>Running a Docker container from the image and binding the current
directory to <code>/home/singularity</code> within the container can be
achieved as follows:</p>
<pre><code>docker run --privileged --rm -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim</code></pre>
<p>Note that the image is configured to run the <code>singularity</code>
command by default. So, when you run a container from it with no
arguments, you see the singularity help output as if you had Singularity
installed locally and had typed <code>singularity</code> on the command
line.</p>
<p>To run a Singularity command, such as
<code>singularity cache list</code>, within the docker container
directly from the host system’s terminal you’d enter:</p>
<pre><code>docker run --privileged --rm -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim cache list</code></pre>
<p>The following diagram shows how the Docker Singularity image is being
used to run a container on your host system and how a Singularity
container can, in turn, be started within the Docker container:</p>
<figure><img src="/fig/SingularityInDocker.png" class="figure mx-auto d-block"></figure><ol start="2" style="list-style-type: decimal">
<li><em>Can you run an interactive shell in the Docker Singularity
container?</em></li>
</ol>
<p>To start a shell within the Singularity Docker container where you
can then run the <code>singularity</code> command directly:</p>
<pre><code>docker run -it --entrypoint=/bin/sh --privileged --rm -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim</code></pre>
<p>Here we use the <code>--entrypoint</code> switch to the
<code>docker</code> command to override the default behaviour when
starting the container and instead of running the
<code>singularity</code> command directly, we run a ‘sh’ shell. We also
add the <code>-it</code> switch to provide an interactive terminal
connection.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>Can you run an interactive Singularity shell in a Singularity
container, within the Docker Singularity container?!</em></li>
</ol>
<p>As shown in the diagram above, you can do this. It is necessary to
run <code>singularity shell &lt;image file name&gt;</code> within the
Docker Singularity container. You would use a command similar to the
following (assuming that <code>my_test_image.sif</code> is in the
current directory where you run this command):</p>
<pre><code>docker run --rm -it --privileged -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim shell --contain /home/singularity/my_test_image.sif</code></pre>
<p>You may notice there’s a flag being passed to singularity shell
(<code>--contain</code> - <code>-c</code> is the short form and also
works). What is this doing? When running a singularity container, you
may remember that we highlighted that some key files/directories from
the host system are mapped into containers by default when you start
them. The configuration in the Docker Singularity container attempts to
mount the file <code>/etc/localtime</code> into the Singularity
container but there is not a timezone configuration present in the
Docker Singularity container and this file doesn’t exist resulting in an
error. <code>--contain</code> prevents the default mounting of some key
files/directories into the container and prevents this error from
occurring. Later in this material, there’s an example of how to rectify
the issue by creating a timezone configuration in the Docker Singularity
container so that the <code>--contain</code> switch is no longer
needed.</p>
<p><em>Summary / Comments:</em></p>
<p>You may choose to:</p>
<ul>
<li>open a shell within the Docker image so you can work at a command
prompt and run the <code>singularity</code> command directly</li>
<li>use the <code>docker run</code> command to run a new container
instance every time you want to run the <code>singularity</code> command
(the Docker Singularity image is configured with the
<code>singularity</code> command as its entrypoint).</li>
</ul>
<p>Either option is fine for this section of the material.</p>
<p>To make things easier to read in the remainder of the material,
command examples will use the <code>singularity</code> command directly,
e.g. <code>singularity cache list</code>. If you’re running a shell in
the Docker Singularity container, you can enter the commands as they
appear. If you’re using the container’s default run behaviour and
running a container instance for each run of the command, you’ll need to
replace <code>singularity</code> with
<code>docker run --privileged -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim</code>
or similar.</p>
<p>This can be a little cumbersome to work with. However, if you’re
using Linux or macOS on your host system, you can add a <em>command
alias</em> to alias the command <code>singularity</code> on your host
system to run the Docker Singularity container, e.g. (for bash shells -
syntax for other shells varies):</p>
<pre><code>alias singularity='docker run --privileged -v ${PWD}:/home/singularity quay.io/singularity/singularity:v3.5.3-slim'</code></pre>
<p>This means you’ll only have to type <code>singularity</code> at the
command line as shown in the examples throughout this section of the
material</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A Docker image is provided to run Singularity - this avoids the need
to have a local Singularity installation on your system.</li>
<li>The Docker Singularity image can be used to build containers on
Linux, macOS and Windows.</li>
<li>You can also run Singularity containers within the Docker
Singularity image.</li>
</ul>
</div>
</div>
</div>
</section></section><section id="aio-07-singularity-images-building"><p>Content from <a href="07-singularity-images-building.html">Building Singularity images</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/07-singularity-images-building.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I create my own Singularity images?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Understand the different Singularity container file formats.</li>
<li>Understand how to build and share your own Singularity
containers.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="building-singularity-images">Building Singularity images<a class="anchor" aria-label="anchor" href="#building-singularity-images"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>As a platform that is widely used in the scientific/research software
and HPC communities, Singularity provides great support for
reproducibility. If you build a Singularity image for some scientific
software, it’s likely that you and/or others will want to be able to
reproduce exactly the same environment again. Maybe you want to verify
the results of the code or provide a means that others can use to verify
the results to support a paper or report. Maybe you’re making a tool
available to others and want to ensure that they have exactly the right
version/configuration of the code.</p>
<p>Similarly to Docker and many other modern software tools, Singularity
follows the “Configuration as code” approach and a container
configuration can be stored in a file which can then be committed to
your version control system alongside other code. Assuming it is
suitably configured, this file can then be used by you or other
individuals (or by automated build tools) to reproduce a container with
the same configuration at some point in the future.</p>
</div>
<div class="section level3">
<h3 id="different-approaches-to-building-images">Different approaches to building images<a class="anchor" aria-label="anchor" href="#different-approaches-to-building-images"></a>
</h3>
<p>There are various approaches to building Singularity images. We
highlight two different approaches here and focus on one of them:</p>
<ul>
<li>
<em>Building within a sandbox:</em> You can build a container
interactively within a sandbox environment. This means you get a shell
within the container environment and install and configure packages and
code as you wish before exiting the sandbox and converting it into a
container image.</li>
<li>
<em>Building from a <a href="https://sylabs.io/guides/3.5/user-guide/build_a_container.html#creating-writable-sandbox-directories" class="external-link">Singularity
Definition File</a></em>: This is Singularity’s equivalent to building a
Docker container from a <code>Dockerfile</code> and we’ll discuss this
approach in this section.</li>
</ul>
<p>You can take a look at Singularity’s “<a href="https://sylabs.io/guides/3.5/user-guide/build_a_container.html" class="external-link">Build
a Container</a>” documentation for more details on different approaches
to building containers.</p>
<div id="why-look-at-singularity-definition-files" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="why-look-at-singularity-definition-files" class="callout-inner">
<h3 class="callout-title">Why look at Singularity Definition Files?</h3>
<div class="callout-content">
<p>Why do you think we might be looking at the <em>definition file
approach</em> here rather than the <em>sandbox approach</em>?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Discussion
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>The sandbox approach is great for prototyping and testing out an
image configuration but it doesn’t provide the best support for our
ultimate goal of <em>reproducibility</em>. If you spend time sitting at
your terminal in front of a shell typing different commands to add
configuration, maybe you realise you made a mistake so you undo one
piece of configuration and change it. This goes on until you have your
completed, working configuration but there’s no explicit record of
exactly what you did to create that configuration.</p>
<p>Say your container image file gets deleted by accident, or someone
else wants to create an equivalent image to test something. How will
they do this and know for sure that they have the same configuration
that you had? With a definition file, the configuration steps are
explicitly defined and can be easily stored (and re-run).</p>
<p>Definition files are small text files while container files may be
very large, multi-gigabyte files that are difficult and time consuming
to move around. This makes definition files ideal for storing in a
version control system along with their revisions.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="creating-a-singularity-definition-file">Creating a Singularity Definition File<a class="anchor" aria-label="anchor" href="#creating-a-singularity-definition-file"></a>
</h3>
<p>A Singularity Definition File is a text file that contains a series
of statements that are used to create a container image. In line with
the <em>configuration as code</em> approach mentioned above, the
definition file can be stored in your code repository alongside your
application code and used to create a reproducible image. This means
that for a given commit in your repository, the version of the
definition file present at that commit can be used to reproduce a
container with a known state. It was pointed out earlier in the course,
when covering Docker, that this property also applies for
Dockerfiles.</p>
<p>We’ll now look at a very simple example of a definition file:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">Bootstrap:</span> docker</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">From:</span> ubuntu:20.04</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="ex">%post</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    <span class="ex">apt-get</span> <span class="at">-y</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> python</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="ex">%runscript</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="ex">python</span> <span class="at">-c</span> <span class="st">'print("Hello World! Hello from our custom Singularity image!")'</span></span></code></pre>
</div>
<p>A definition file has a number of optional sections, specified using
the <code>%</code> prefix, that are used to define or undertake
different configuration during different stages of the image build
process. You can find full details in Singularity’s <a href="https://sylabs.io/guides/3.5/user-guide/definition_files.html" class="external-link">Definition
Files documentation</a>. In our very simple example here, we only use
the <code>%post</code> and <code>%runscript</code> sections.</p>
<p>Let’s step through this definition file and look at the lines in more
detail:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">Bootstrap:</span> docker</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">From:</span> ubuntu:20.04</span></code></pre>
</div>
<p>These first two lines define where to <em>bootstrap</em> our image
from. Why can’t we just put some application binaries into a blank
image? Any applications or tools that we want to run will need to
interact with standard system libraries and potentially a wide range of
other libraries and tools. These need to be available within the image
and we therefore need some sort of operating system as the basis for our
image. The most straightforward way to achieve this is to start from an
existing base image containing an operating system. In this case, we’re
going to start from a minimal Ubuntu 20.04 Linux Docker image. Note that
we’re using a Docker image as the basis for creating a Singularity
image. This demonstrates the flexibility in being able to start from
different types of images when creating a new Singularity image.</p>
<p>The <code>Bootstrap: docker</code> line is similar to prefixing an
image path with <code>docker://</code> when using, for example, the
<code>singularity pull</code> command. A range of <a href="https://sylabs.io/guides/3.5/user-guide/definition_files.html#preferred-bootstrap-agents" class="external-link">different
bootstrap options</a> are supported. <code>From: ubuntu:20.04</code>
says that we want to use the <code>ubuntu</code> image with the tag
<code>20.04</code> from Docker Hub.</p>
<p>Next we have the <code>%post</code> section of the definition
file:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">%post</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="ex">apt-get</span> <span class="at">-y</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> python3</span></code></pre>
</div>
<p>In this section of the file we can do tasks such as package
installation, pulling data files from remote locations and undertaking
local configuration within the image. The commands that appear in this
section are standard shell commands and they are run <em>within</em> the
context of our new container image. So, in the case of this example,
these commands are being run within the context of a minimal Ubuntu
20.04 image that initially has only a very small set of core packages
installed.</p>
<p>Here we use Ubuntu’s package manager to update our package indexes
and then install the <code>python3</code> package along with any
required dependencies. The <code>-y</code> switches are used to accept,
by default, interactive prompts that might appear asking you to confirm
package updates or installation. This is required because our definition
file should be able to run in an unattended, non-interactive
environment.</p>
<p>Finally we have the <code>%runscript</code> section:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">%runscript</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="ex">python3</span> <span class="at">-c</span> <span class="st">'print("Hello World! Hello from our custom Singularity image!")'</span></span></code></pre>
</div>
<p>This section is used to define a script that should be run when a
container is started based on this image using the
<code>singularity run</code> command. In this simple example we use
<code>python3</code> to print out some text to the console.</p>
<p>We can now save the contents of the simple defintion file shown above
to a file and build an image based on it. In the case of this example,
the definition file has been named <code>my_test_image.def</code>. (Note
that the instructions here assume you’ve bound the image output
directory you created to the <code>/home/singularity</code> directory in
your Docker Singularity container, as explained in the “<a href="#getting-started-with-the-docker-singularity-image"><em>Getting
started with the Docker Singularity image</em></a>” section above.):</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> singularity build /home/singularity/my_test_image.sif /home/singularity/my_test_image.def</span></code></pre>
</div>
<p>Recall from the details at the start of this section that if you are
running your command from the host system command line, running an
instance of a Docker container for each run of the command, your command
will look something like this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--privileged</span> <span class="at">--rm</span> <span class="at">-v</span> <span class="va">${PWD}</span>:/home/singularity quay.io/singularity/singularity:v3.5.3-slim build /home/singularity/my_test_image.sif /home/singularity/my_test_image.def</span></code></pre>
</div>
<p>The above command requests the building of an image based on the
<code>my_test_image.def</code> file with the resulting image saved to
the <code>my_test_image.sif</code> file. Note that you will need to
prefix the command with <code>sudo</code> if you’re running a locally
installed version of Singularity and not running via Docker because it
is necessary to have administrative privileges to build the image. You
should see output similar to the following:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Starting build...
Getting image source signatures
Copying blob d51af753c3d3 skipped: already exists
Copying blob fc878cd0a91c skipped: already exists
Copying blob 6154df8ff988 skipped: already exists
Copying blob fee5db0ff82f skipped: already exists
Copying config 95c3f3755f done
Writing manifest to image destination
Storing signatures
2020/04/29 13:36:35  info unpack layer: sha256:d51af753c3d3a984351448ec0f85ddafc580680fd6dfce9f4b09fdb367ee1e3e
2020/04/29 13:36:36  info unpack layer: sha256:fc878cd0a91c7bece56f668b2c79a19d94dd5471dae41fe5a7e14b4ae65251f6
2020/04/29 13:36:36  info unpack layer: sha256:6154df8ff9882934dc5bf265b8b85a3aeadba06387447ffa440f7af7f32b0e1d
2020/04/29 13:36:36  info unpack layer: sha256:fee5db0ff82f7aa5ace63497df4802bbadf8f2779ed3e1858605b791dc449425
INFO:    Running post scriptlet
+ apt-get -y update
Get:1 http://archive.ubuntu.com/ubuntu focal InRelease [265 kB]
...
  [Package update output truncated]
...
Fetched 13.4 MB in 2s (5575 kB/s)
Reading package lists... Done
+ apt-get install -y python3
Reading package lists... Done
...
  [Package install output truncated]
...Processing triggers for libc-bin (2.31-0ubuntu9) ...
INFO:    Adding runscript
INFO:    Creating SIF file...
INFO:    Build complete: my_test_image.sif
$ </code></pre>
</div>
<p>You should now have a <code>my_test_image.sif</code> file in the
current directory. Note that in the above output, where it says
<code>INFO:  Starting build...</code> there is a series of
<code>skipped: already exists</code> messages for the
<code>Copying blob</code> lines. This is because the Docker image slices
for the Ubuntu 20.04 image have previously been downloaded and are
cached on the system where this example is being run. On your system, if
the image is not already cached, you will see the slices being
downloaded from Docker Hub when these lines of output appear.</p>
<div id="permissions-of-the-created-image-file" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="permissions-of-the-created-image-file" class="callout-inner">
<h3 class="callout-title">Permissions of the created image file</h3>
<div class="callout-content">
<p>You may find that the created Singularity image file on your host
filesystem is owned by the <code>root</code> user and not your user. In
this case, you won’t be able to change the ownership/permissions of the
file directly if you don’t have root access.</p>
<p>However, the image file will be readable by you and you should be
able to take a copy of the file under a new name which you will then
own. You will then be able to modify the permissions of this copy of the
image and delete the original root-owned file since the default
permissions should allow this.</p>
</div>
</div>
</div>
<div id="cluster-platform-configuration-for-running-singularity-containers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="cluster-platform-configuration-for-running-singularity-containers" class="callout-inner">
<h3 class="callout-title">Cluster platform configuration for running Singularity containers</h3>
<div class="callout-content">
<p><em><strong>Note to instructors:</strong> Add details into this box
of any custom configuration that needs to be done on the cluster
platform or other remote system that you’re providing access to for the
purpose of undertaking this course. If <code>singularity</code> does not
require any custom configuration by the user on the host platform, you
can remove this box.</em></p>
</div>
</div>
</div>
<p>It is recommended that you move the created <code>.sif</code> file to
a platform with an installation of Singularity, rather than attempting
to run the image using the Docker container. However, if you do wish to
try using the Docker container, see the notes below on “<em>Using
singularity run from within the Docker container</em>” for further
information.</p>
<p>If you have access to a remote platform with Singularity installed on
it, you should now move your created <code>.sif</code> image file to
this platform. You could, for example, do this using the command line
secure copy command <code>scp</code>.</p>
<div id="using-scp-secure-copy-to-copy-files-between-systems" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="using-scp-secure-copy-to-copy-files-between-systems" class="callout-inner">
<h3 class="callout-title">Using <code>scp</code> (secure copy) to copy
files between systems</h3>
<div class="callout-content">
<p><code>scp</code> is a widely used tool that uses the SSH protocol to
securely copy files between systems. As such, the syntax is similar to
that of SSH.</p>
<p>For example, if you want to copy the <code>my_image.sif</code> file
from the current directory on your local system to your home directory
(e.g. <code>/home/myuser/</code>) on a remote system
(e.g. <em>hpc.myinstitution.ac.uk</em>) where an SSH private key is
required for login, you would use a command similar to the
following:</p>
<pre><code>scp -i /path/to/keyfile/id_mykey ./my_image.sif myuser@hpc.myinstitution.ac.uk:/home/myuser/</code></pre>
<p>Note that if you leave off the <code>/home/myuser</code> and just end
the command with the <code>:</code>, the file will, by default, be
copied to your home directory.</p>
</div>
</div>
</div>
<p>We can now attempt to run a container from the image that we
built:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">$</span> singularity run my_test_image.sif</span></code></pre>
</div>
<p>If everything worked successfully, you should see the message printed
by Python:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Hello World! Hello from our custom Singularity image!</code></pre>
</div>
<div id="using-singularity-run-from-within-the-docker-container" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="using-singularity-run-from-within-the-docker-container" class="callout-inner">
<h3 class="callout-title">Using <code>singularity run</code> from within
the Docker container</h3>
<div class="callout-content">
<p>It is strongly recommended that you don’t use the Docker container
for running Singularity images, only for creating them, since the
Singularity command runs within the container as the root user.</p>
<p>However, for the purposes of this simple example, and potentially for
testing/debugging purposes it is useful to know how to run a Singularity
container within the Docker Singularity container. You may recall from
the <a href="06-singularity-images-prep.html">Running a container from
the image</a> section in the previous episode that we used the
<code>--contain</code> switch with the <code>singularity</code> command.
If you don’t use this switch, it is likely that you will get an error
relating to <code>/etc/localtime</code> similar to the following:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARNING: skipping mount of /etc/localtime: no such file or directory
FATAL:   container creation failed: mount /etc/localtime-&gt;/etc/localtime error: while mounting /etc/localtime: mount source /etc/localtime doesn't exist</code></pre>
</div>
<p>This occurs because the <code>/etc/localtime</code> file that
provides timezone configuration is not present within the Docker
container. If you want to use the Docker container to test that your
newly created image runs, you can use the <code>--contain</code> switch,
or you can open a shell in the Docker container and add a timezone
configuration as described in the <a href="https://wiki.alpinelinux.org/wiki/Setting_the_timezone" class="external-link">Alpine
Linux documentation</a>:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">$</span> apk add tzdata</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="ex">$</span> cp /usr/share/zoneinfo/Europe/London /etc/localtime</span></code></pre>
</div>
<p>The <code>singularity run</code> command should now work successfully
without needing to use <code>--contain</code>. Bear in mind that once
you exit the Docker Singularity container shell and shutdown the
container, this configuration will not persist.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="more-advanced-definition-files">More advanced definition files<a class="anchor" aria-label="anchor" href="#more-advanced-definition-files"></a>
</h3>
<p>Here we’ve looked at a very simple example of how to create an image.
At this stage, you might want to have a go at creating your own
definition file for some code of your own or an application that you
work with regularly. There are several definition file sections that
were <em>not</em> used in the above example, these are:</p>
<ul>
<li><code>%setup</code></li>
<li><code>%files</code></li>
<li><code>%environment</code></li>
<li><code>%startscript</code></li>
<li><code>%test</code></li>
<li><code>%labels</code></li>
<li><code>%help</code></li>
</ul>
<p>The <a href="https://sylabs.io/guides/3.5/user-guide/definition_files.html#sections" class="external-link"><code>Sections</code>
part of the definition file documentation</a> details all the sections
and provides an example definition file that makes use of all the
sections.</p>
</div>
<div class="section level3">
<h3 id="additional-singularity-features">Additional Singularity features<a class="anchor" aria-label="anchor" href="#additional-singularity-features"></a>
</h3>
<p>Singularity has a wide range of features. You can find full details
in the <a href="https://sylabs.io/guides/3.5/user-guide/index.html" class="external-link">Singularity
User Guide</a> and we highlight a couple of key features here that may
be of use/interest:</p>
<p><strong>Remote Builder Capabilities:</strong> If you have access to a
platform with Singularity installed but you don’t have root access to
create containers, you may be able to use the <a href="https://cloud.sylabs.io/builder" class="external-link">Remote Builder</a> functionality
to offload the process of building an image to remote cloud resources.
You’ll need to register for a <em>cloud token</em> via the link on the
<a href="https://cloud.sylabs.io/builder" class="external-link">Remote Builder</a> page.</p>
<p><strong>Signing containers:</strong> If you do want to share
container image (<code>.sif</code>) files directly with colleagues or
collaborators, how can the people you send an image to be sure that they
have received the file without it being tampered with or suffering from
corruption during transfer/storage? And how can you be sure that the
same goes for any container image file you receive from others?
Singularity supports signing containers. This allows a digital signature
to be linked to an image file. This signature can be used to verify that
an image file has been signed by the holder of a specific key and that
the file is unchanged from when it was signed. You can find full details
of how to use this functionality in the Singularity documentation on <a href="https://sylabs.io/guides/3.0/user-guide/signNverify.html" class="external-link">Signing
and Verifying Containers</a>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Singularity definition files are used to define the build process
and configuration for an image.</li>
<li>Singularity’s Docker container provides a way to build images on a
platform where Singularity is not installed but Docker is
available.</li>
<li>Existing images from remote registries such as Docker Hub and
Singularity Hub can be used as a base for creating new Singularity
images.</li>
</ul>
</div>
</div>
</div>
</div>
</section></section><section id="aio-08-singularity-mpi"><p>Content from <a href="08-singularity-mpi.html">Running MPI parallel jobs using Singularity containers</a></p>
<hr>
<p>Last updated on 2025-01-27 |

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/episodes/08-singularity-mpi.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I set up and run an MPI job from a Singularity
container?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how MPI applications within Singularity containers can be run
on HPC platforms</li>
<li>Understand the challenges and related performance implications when
running MPI jobs via Singularity</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="running-mpi-parallel-codes-with-singularity-containers">Running MPI parallel codes with Singularity containers<a class="anchor" aria-label="anchor" href="#running-mpi-parallel-codes-with-singularity-containers"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="mpi-overview">MPI overview<a class="anchor" aria-label="anchor" href="#mpi-overview"></a>
</h3>
<p>MPI - <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface" class="external-link">Message
Passing Interface</a> - is a widely used standard for parallel
programming. It is used for exchanging messages/data between processes
in a parallel application. If you’ve been involved in developing or
working with computational science software, you may already be familiar
with MPI and running MPI applications.</p>
<p>When working with an MPI code on a large-scale cluster, a common
approach is to compile the code yourself, within your own user directory
on the cluster platform, building against the supported MPI
implementation on the cluster. Alternatively, if the code is widely used
on the cluster, the platform administrators may build and package the
application as a module so that it is easily accessible by all users of
the cluster.</p>
</div>
<div class="section level3">
<h3 id="mpi-codes-with-singularity-containers">MPI codes with Singularity containers<a class="anchor" aria-label="anchor" href="#mpi-codes-with-singularity-containers"></a>
</h3>
<p>We’ve already seen that building Singularity containers can be
impractical without root access. Since we’re highly unlikely to have
root access on a large institutional, regional or national cluster,
building a container directly on the target platform is not normally an
option.</p>
<p>If our target platform uses <a href="https://www.open-mpi.org/" class="external-link">OpenMPI</a>, one of the two widely used
source MPI implementations, we can build/install a compatible OpenMPI
version on our local build platform, or directly within the image as
part of the image build process. We can then build our code that
requires MPI, either interactively in an image sandbox or via a
definition file.</p>
<p>If the target platform uses a version of MPI based on <a href="https://www.mpich.org/" class="external-link">MPICH</a>, the other widely used open
source MPI implementation, there is <a href="https://www.mpich.org/abi/" class="external-link">ABI compatibility between MPICH and
several other MPI implementations</a>. In this case, you can build MPICH
and your code on a local platform, within an image sandbox or as part of
the image build process via a definition file, and you should be able to
successfully run containers based on this image on your target cluster
platform.</p>
<p>As described in Singularity’s <a href="https://sylabs.io/guides/3.5/user-guide/mpi.html" class="external-link">MPI
documentation</a>, support for both OpenMPI and MPICH is provided.
Instructions are given for building the relevant MPI version from source
via a definition file and we’ll see this used in an example below.</p>
<div class="section level4">
<h4 id="container-portability-and-performance-on-hpc-platforms">
<strong>Container portability and performance on HPC
platforms</strong><a class="anchor" aria-label="anchor" href="#container-portability-and-performance-on-hpc-platforms"></a>
</h4>
<p>While building a container on a local system that is intended for use
on a remote HPC platform does provide some level of portability, if
you’re after the best possible performance, it can present some issues.
The version of MPI in the container will need to be built and configured
to support the hardware on your target platform if the best possible
performance is to be achieved. Where a platform has specialist hardware
with proprietary drivers, building on a different platform with
different hardware present means that building with the right driver
support for optimal performance is not likely to be possible. This is
especially true if the version of MPI available is different (but
compatible). Singularity’s <a href="https://sylabs.io/guides/3.5/user-guide/mpi.html" class="external-link">MPI
documentation</a> highlights two different models for working with MPI
codes. The <em><a href="https://sylabs.io/guides/3.5/user-guide/mpi.html#hybrid-model" class="external-link">hybrid
model</a></em> that we’ll be looking at here involves using the MPI
executable from the MPI installation on the host system to launch
singularity and run the application within the container. The
application in the container is linked against and uses the MPI
installation within the container which, in turn, communicates with the
MPI daemon process running on the host system. In the following section
we’ll look at building a Singularity image containing a small MPI
application that can then be run using the hybrid model.</p>
</div>
</div>
<div class="section level3">
<h3 id="building-and-running-a-singularity-image-for-an-mpi-code">Building and running a Singularity image for an MPI code<a class="anchor" aria-label="anchor" href="#building-and-running-a-singularity-image-for-an-mpi-code"></a>
</h3>
<div class="section level4">
<h4 id="building-and-testing-an-image">
<strong>Building and testing an image</strong><a class="anchor" aria-label="anchor" href="#building-and-testing-an-image"></a>
</h4>
<p>This example makes the assumption that you’ll be building a container
image on a local platform and then deploying it to a cluster with a
different but compatible MPI implementation. See <a href="https://sylabs.io/guides/3.5/user-guide/mpi.html#singularity-and-mpi-applications" class="external-link">Singularity
and MPI applications</a> in the Singularity documentation for further
information on how this works.</p>
<p>We’ll build an image from a definition file. Containers based on this
image will be able to run MPI benchmarks using the <a href="https://mvapich.cse.ohio-state.edu/benchmarks/" class="external-link">OSU
Micro-Benchmarks</a> software.</p>
<p>In this example, the target platform is a remote HPC cluster that
uses <a href="https://software.intel.com/content/www/us/en/develop/tools/mpi-library.html" class="external-link">Intel
MPI</a>. The container can be built via the Singularity Docker image
that we used in the previous episode of the Singularity material.</p>
<p>Begin by creating a directory and, within that directory, downloading
and saving the “tarballs” for version 5.7.1 of the OSU Micro-Benchmarks
from the <a href="https://mvapich.cse.ohio-state.edu/benchmarks/" class="external-link">OSU
Micro-Benchmarks page</a> and for MPICH version 3.4.2 from the <a href="https://www.mpich.org/downloads/" class="external-link">MPICH downloads page</a>.</p>
<p>In the same directory, save the following definition file content to
a <code>.def</code> file, e.g. <code>osu_benchmarks.def</code>:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Bootstrap: docker
From: ubuntu:20.04

%files
    /home/singularity/osu-micro-benchmarks-5.7.1.tgz /root/
    /home/singularity/mpich-3.4.2.tar.gz /root/

%environment
    export SINGULARITY_MPICH_DIR=/usr
    export OSU_DIR=/usr/local/osu/libexec/osu-micro-benchmarks/mpi

%post
    apt-get -y update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y install build-essential libfabric-dev libibverbs-dev gfortran
    cd /root
    tar zxvf mpich-3.4.2.tar.gz &amp;&amp; cd mpich-3.4.2
    echo "Configuring and building MPICH..."
    ./configure --prefix=/usr --with-device=ch3:nemesis:ofi &amp;&amp; make -j2 &amp;&amp; make install
    cd /root
    tar zxvf osu-micro-benchmarks-5.7.1.tgz
    cd osu-micro-benchmarks-5.7.1/
    echo "Configuring and building OSU Micro-Benchmarks..."
    ./configure --prefix=/usr/local/osu CC=/usr/bin/mpicc CXX=/usr/bin/mpicxx
    make -j2 &amp;&amp; make install

%runscript
    echo "Rank ${PMI_RANK} - About to run: ${OSU_DIR}/$*"
    exec ${OSU_DIR}/$*</code></pre>
</div>
<p>A quick overview of what the above definition file is doing:</p>
<ul>
<li>The image is being bootstrapped from the <code>ubuntu:20.04</code>
Docker image.</li>
<li>In the <code>%files</code> section: The OSU Micro-Benchmarks and
MPICH tar files are copied from the current directory into the
<code>/root</code> directory within the image.</li>
<li>In the <code>%environment</code> section: Set a couple of
environment variables that will be available within all containers run
from the generated image.</li>
<li>In the <code>%post</code> section:
<ul>
<li>Ubuntu’s <code>apt-get</code> package manager is used to update the
package directory and then install the compilers and other libraries
required for the MPICH build.</li>
<li>The MPICH .tar.gz file is extracted and the configure, build and
install steps are run. Note the use of the <code>--with-device</code>
option to configure MPICH to use the correct driver to support improved
communication performance on a high performance cluster.</li>
<li>The OSU Micro-Benchmarks .tar.gz file is extracted and the
configure, build and install steps are run to build the benchmark code
from source.</li>
</ul>
</li>
<li>In the <code>%runscript</code> section: A runscript is set up that
will echo the rank number of the current process and then run the
command provided as a command line argument.</li>
</ul>
<p><em>Note that base path of the the executable to run
(<code>$OSU_DIR</code>) is hardcoded in the run script</em>. The command
line parameter that you provide when running a container instance based
on the image is then added to this base path. Example command line
parameters include: <code>startup/osu_hello</code>,
<code>collective/osu_allgather</code>, <code>pt2pt/osu_latency</code>,
<code>one-sided/osu_put_latency</code>.</p>
<div id="build-and-test-the-osu-micro-benchmarks-image" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="build-and-test-the-osu-micro-benchmarks-image" class="callout-inner">
<h3 class="callout-title">Build and test the OSU Micro-Benchmarks image</h3>
<div class="callout-content">
<p>Using the above definition file, build a Singularity image named
<code>osu_benchmarks.sif</code>.</p>
<p>Once the image has finished building, test it by running the
<code>osu_hello</code> benchmark that is found in the
<code>startup</code> benchmark folder.</p>
<p><em>NOTE: If you’re not using the Singularity Docker image to build
your Singularity image, you will need to edit the path to the .tar.gz
file in the <code>%files</code> section of the definition file.</em></p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>You should be able to build an image from the definition file as
follows:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> singularity build osu_benchmarks.sif osu_benchmarks.def</span></code></pre>
</div>
<p><em>Note that if you’re running the Singularity Docker container
directly from the command line to undertake your build, you’ll need to
provide the full path to the <code>.def</code> file
<strong>within</strong> the container</em> - it is likely that this will
be different to the file path on your host system. For example, if
you’ve bind mounted the directory on your local system containing the
file to <code>/home/singularity</code> within the container, the full
path to the <code>.def</code> file will be
<code>/home/singularity/osu_benchmarks.def</code>.</p>
<p>Assuming the image builds successfully, you can then try running the
container locally and also transfer the SIF file to a cluster platform
that you have access to (that has Singularity installed) and run it
there.</p>
<p>Let’s begin with a single-process run of
<code>startup/osu_hello</code> on <em>your local system</em> (where you
built the container) to ensure that we can run the container as
expected. We’ll use the MPI installation <em>within</em> the container
for this test. <em>Note that when we run a parallel job on an HPC
cluster platform, we use the MPI installation on the cluster to
coordinate the run so things are a little different…</em></p>
<p>Start a shell in the Singularity container based on your image and
then run a single process job via <code>mpirun</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> singularity shell <span class="at">--contain</span> /home/singularity/osu_benchmarks.sif</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">Singularity</span><span class="op">&gt;</span> mpirun <span class="at">-np</span> 1 <span class="va">$OSU_DIR</span>/startup/osu_hello</span></code></pre>
</div>
<p>You should see output similar to the following:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># OSU MPI Hello World Test v5.7.1
This is a test with 1 processes</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="running-singularity-containers-via-mpi">
<strong>Running Singularity containers via MPI</strong><a class="anchor" aria-label="anchor" href="#running-singularity-containers-via-mpi"></a>
</h4>
<p>Assuming the above tests worked, we can now try undertaking a
parallel run of one of the OSU benchmarking tools within our container
image.</p>
<p>This is where things get interesting and we’ll begin by looking at
how Singularity containers are run within an MPI environment.</p>
<p>If you’re familiar with running MPI codes, you’ll know that you use
<code>mpirun</code> (as we did in the previous example),
<code>mpiexec</code> or a similar MPI executable to start your
application. This executable may be run directly on the local system or
cluster platform that you’re using, or you may need to run it through a
job script submitted to a job scheduler. Your MPI-based application
code, which will be linked against the MPI libraries, will make MPI API
calls into these MPI libraries which in turn talk to the MPI daemon
process running on the host system. This daemon process handles the
communication between MPI processes, including talking to the daemons on
other nodes to exchange information between processes running on
different machines, as necessary.</p>
<p>When running code within a Singularity container, we don’t use the
MPI executables stored within the container (i.e. we DO NOT run
<code>singularity exec mpirun -np &lt;numprocs&gt; /path/to/my/executable</code>).
Instead we use the MPI installation on the host system to run
Singularity and start an instance of our executable from within a
container for each MPI process. Without Singularity support in an MPI
implementation, this results in starting a separate Singularity
container instance within each process. This can present some overhead
if a large number of processes are being run on a host. Where
Singularity support is built into an MPI implementation this can address
this potential issue and reduce the overhead of running code from within
a container as part of an MPI job.</p>
<p>Ultimately, this means that our running MPI code is linking to the
MPI libraries from the MPI install within our container and these are,
in turn, communicating with the MPI daemon on the host system which is
part of the host system’s MPI installation. In the case of MPICH, these
two installations of MPI may be different but as long as there is <a href="https://wiki.mpich.org/mpich/index.php/ABI_Compatibility_Initiative" class="external-link">ABI
compatibility</a> between the version of MPI installed in your container
image and the version on the host system, your job should run
successfully.</p>
<p>We can now try running a 2-process MPI run of a point to point
benchmark <code>osu_latency</code>. If your local system has both MPI
and Singularity installed and has multiple cores, you can run this test
on that system. Alternatively you can run on a cluster. Note that you
may need to submit this command via a job submission script submitted to
a job scheduler if you’re running on a cluster. If you’re attending a
taught version of this course, some information will be provided below
in relation to the cluster that you’ve been provided with access to.</p>
<div id="undertake-a-parallel-run-of-the-osu_latency-benchmark-general-example" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="undertake-a-parallel-run-of-the-osu_latency-benchmark-general-example" class="callout-inner">
<h3 class="callout-title">Undertake a parallel run of the
<code>osu_latency</code> benchmark (general example)</h3>
<div class="callout-content">
<p>Move the <code>osu_benchmarks.sif</code> Singularity image onto the
cluster (or other suitable) platform where you’re going to undertake
your benchmark run.</p>
<p>You should be able to run the benchmark using a command similar to
the one shown below. However, if you are running on a cluster, you may
need to write and submit a job submission script at this point to
initiate running of the benchmark.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> mpirun <span class="at">-np</span> 2 singularity run osu_benchmarks.sif pt2pt/osu_latency</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Expected output and discussion </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>As you can see in the mpirun command shown above, we have called
<code>mpirun</code> on the host system and are passing to MPI the
<code>singularity</code> executable for which the parameters are the
image file and any parameters we want to pass to the image’s run script,
in this case the path/name of the benchmark executable to run.</p>
<p>The following shows an example of the output you should expect to
see. You should have latency values shown for message sizes up to
4MB.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rank 1 - About to run: /.../mpi/pt2pt/osu_latency
Rank 0 - About to run: /.../mpi/pt2pt/osu_latency
# OSU MPI Latency Test v5.6.2
# Size          Latency (us)
0                       0.38
1                       0.34
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="undertake-a-parallel-run-of-the-osu_latency-benchmark-taught-course-cluster-example" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="undertake-a-parallel-run-of-the-osu_latency-benchmark-taught-course-cluster-example" class="callout-inner">
<h3 class="callout-title">Undertake a parallel run of the
<code>osu_latency</code> benchmark (taught course cluster example)</h3>
<div class="callout-content">
<p><em><strong>Note to instructors:</strong> Add details into this box
relating to running the above example on your chosen cluster platform.
The example SLURM script provided here is based on the UK’s ARCHER2 HPC
platform, you should replace the template file in the <code>files</code>
directory of the repository with a submission script suited to your
platform, if one is required.</em></p>
<p>This version of the exercise, for undertaking a parallel run of the
osu_latency benchmark with your Singularity container that contains an
MPI build, is specific to this run of the course.</p>
<p>The information provided here is specifically tailored to the HPC
platform that you’ve been given access to for this taught version of the
course.</p>
<p>Move the <code>osu_benchmarks.sif</code> Singularity image onto the
cluster where you’re going to undertake your benchmark run. You should
use <code>scp</code> or a similar utility to copy the file.</p>
<p>The platform you’ve been provided with access to uses
<code>Slurm</code> to schedule jobs to run on the platform. You now need
to create a <code>Slurm</code> job submission script to run the
benchmark.</p>
<p>Download this <a href="%7B%7Bsite.url%7D%7Dfiles/osu_latency.slurm.template">template
script</a> and edit it to suit your configuration.</p>
<p>Submit the modified job submission script to the <code>Slurm</code>
scheduler using the <code>sbatch</code> command.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> sbatch osu_latency.slurm</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Expected output and discussion </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>As you will have seen in the commands using the provided template job
submission script, we have called <code>mpirun</code> on the host system
and are passing to MPI the <code>singularity</code> executable for which
the parameters are the image file and any parameters we want to pass to
the image’s run script. In this case, the parameters are the path/name
of the benchmark executable to run.</p>
<p>The following shows an example of the output you should expect to
see. You should have latency values shown for message sizes up to
4MB.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>INFO:    Convert SIF file to sandbox...
INFO:    Convert SIF file to sandbox...
Rank 1 - About to run: /.../mpi/pt2pt/osu_latency
Rank 0 - About to run: /.../mpi/pt2pt/osu_latency
# OSU MPI Latency Test v5.6.2
# Size          Latency (us)
0                       1.49
1                       1.50
2                       1.50
...
4194304               915.44
INFO:    Cleaning up image...
INFO:    Cleaning up image...</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This has demonstrated that we can successfully run a parallel MPI
executable from within a Singularity container. However, in this case,
the two processes will almost certainly have run on the same physical
node so this is not testing the performance of the interconnects between
nodes.</p>
<p>You could now try running a larger-scale test. You can also try
running a benchmark that uses multiple processes, for example try
<code>collective/osu_gather</code>.</p>
<div id="investigate-performance-when-using-a-container-image-built-on-a-local-system-and-run-on-a-cluster" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="investigate-performance-when-using-a-container-image-built-on-a-local-system-and-run-on-a-cluster" class="callout-inner">
<h3 class="callout-title">Investigate performance when using a container image built on a local system and run on a cluster</h3>
<div class="callout-content">
<p>To get an idea of any difference in performance between the code
within your Singularity image and the same code built natively on the
target HPC platform, try building the OSU benchmarks from source,
locally on the cluster. Then try running the same benchmark(s) that you
ran via the singularity container. Have a look at the outputs you get
when running <code>collective/osu_gather</code> or one of the other
collective benchmarks to get an idea of whether there is a performance
difference and how significant it is.</p>
<p>Try running with enough processes that the processes are spread
across different physical nodes so that you’re making use of the
cluster’s network interconnects.</p>
<p>What do you see?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Discussion </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>You may find that performance is significantly better with the
version of the code built directly on the HPC platform. Alternatively,
performance may be similar between the two versions.</p>
<p>How big is the performance difference between the two builds of the
code?</p>
<p>What might account for any difference in performance between the two
builds of the code?</p>
</div>
</div>
</div>
</div>
<p>If performance is an issue for you with codes that you’d like to run
via Singularity, you are advised to take a look at using the <em><a href="https://sylabs.io/guides/3.5/user-guide/mpi.html#bind-model" class="external-link">bind
model</a></em> for building/running MPI applications through
Singularity.</p>
</div>
</div>
</section><section><h2 class="section-heading" id="singularity-wrap-up">Singularity wrap-up<a class="anchor" aria-label="anchor" href="#singularity-wrap-up"></a>
</h2>
<hr class="half-width">
<p>This concludes the 8 episodes of the course covering Singularity. We
hope you found this information useful and that it has inspired you to
use Singularity to help enhance the way you build/work with research
software.</p>
<p>As a new set of material, we appreciate that there are likely to be
improvements that can be made to enhance the quality of this material.
We welcome your thoughts, suggestions and feedback on improvements that
could be made to help others making use of these lessons.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Singularity images containing MPI applications can be built on one
platform and then run on another (e.g. an HPC cluster) if the two
platforms have compatible MPI implementations.</li>
<li>When running an MPI application within a Singularity container, use
the MPI executable on the host system to launch a Singularity container
for each process.</li>
<li>Think about parallel application performance requirements and how
where you build/run your image may affect that.</li>
</ul>
</div>
</div>
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/kcl-eresearch/singularity-introduction/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/kcl-eresearch/singularity-introduction/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/kcl-eresearch/singularity-introduction/" class="external-link">Source</a></p>
				<p><a href="https://github.com/kcl-eresearch/singularity-introduction/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:liz.ing-simmons@kcl.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.7" class="external-link">pegboard (0.7.7)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://preview.carpentries.org/singularity-introduction/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://preview.carpentries.org/singularity-introduction/aio.html",
  "identifier": "https://preview.carpentries.org/singularity-introduction/aio.html",
  "dateCreated": "2025-01-27",
  "dateModified": "2025-01-27",
  "datePublished": "2025-01-27"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo --><script>
          var _paq = window._paq = window._paq || [];
          /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
          _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
          _paq.push(["setDomains", ["*.lessons.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
          _paq.push(["setDoNotTrack", true]);
          _paq.push(["disableCookies"]);
          _paq.push(["trackPageView"]);
          _paq.push(["enableLinkTracking"]);
          (function() {
              var u="https://matomo.carpentries.org/";
              _paq.push(["setTrackerUrl", u+"matomo.php"]);
              _paq.push(["setSiteId", "1"]);
              var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0];
              g.async=true; g.src="https://matomo.carpentries.org/matomo.js"; s.parentNode.insertBefore(g,s);
          })();
        </script><!-- End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

